<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Face Keypoint Visualizer</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin: 20px; }
    #status { font-style: italic; margin-bottom: 1rem; }
    canvas { border: 1px solid #ccc; max-width: 100%; height: auto; }
    #upload { margin-top: 1rem; }
  </style>
</head>
<body>
  <h1>Face Keypoint Visualizer</h1>
  <div id="status">Loading…</div>
  <input type="file" id="upload" accept="image/*" />
  <br />
  <canvas id="canvas"></canvas>

  <!-- load the single tfjs bundle -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
  <!-- then the face-landmarks model -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/face-landmarks-detection"></script>

  <script>
    const statusEl = document.getElementById('status');
    const canvas   = document.getElementById('canvas');
    let   detector = null;

    async function init() {
      statusEl.textContent = 'Initializing WebGL…';
      await tf.setBackend('webgl');
      await tf.ready();
      statusEl.textContent = 'Loading FaceMesh…';
      detector = await faceLandmarksDetection.createDetector(
        faceLandmarksDetection.SupportedModels.MediaPipeFaceMesh,
        { runtime: 'tfjs' }
      );
      statusEl.textContent = 'Model loaded! Upload an image.';
      console.log('✔️ Detector ready');
    }
    init();

    document.getElementById('upload').addEventListener('change', async e => {
      const file = e.target.files?.[0];
      if (!file) return;
      const img = new Image();
      img.onload = async () => {
        const ctx = canvas.getContext('2d');
        // set internal resolution to the image size
        canvas.width  = img.naturalWidth;
        canvas.height = img.naturalHeight;
        // draw the image
        ctx.drawImage(img, 0, 0);

        if (!detector) return console.warn('Detector not ready');
        const preds = await detector.estimateFaces(img);
        if (!preds.length) return alert('No faces detected');

        const kp = preds[0].keypoints;

        // draw & label every keypoint
        ctx.lineWidth = 0.5;
        ctx.font      = '6px sans-serif';

        kp.forEach((p, i) => {
          // tiny dot
          ctx.fillStyle = 'red';
          ctx.beginPath();
          ctx.arc(p.x, p.y, 1, 0, 2 * Math.PI);
          ctx.fill();

          // index label
          ctx.fillStyle = 'yellow';
          ctx.fillText(i, p.x + 2, p.y - 2);
        });
      };
      img.src = URL.createObjectURL(file);
    });
  </script>
</body>
</html>
